## The unified AD GWAS-xQTL loci table (`unified_AD_loci_xQTL_summary.xlxs`)

Each row correspond to a variant in a locus that have been associated to AD GWAS (Combining finemaping and Coloc results for the 4 GWAS studies data used). 	

For each AD locus, variants following this criteria are included:
- with maximum GWAS PIP/VCP ('inclusion score') >0.1 
- the top5 variants based on cV2F score are included. 
- the top1 variant based on GWAS PIP/VCP
- the top1 variant based on xQTL PIP/VCP, for each broad context.  

If the variant have been associated to an xQTL, summary are shown in xQTLs summary part.	 


### Unified metric of confidence levels of support for gene level prioritization

xQTL contexts are ordered and green colored according to a confidence score (C1 / darkgreen is best, C6/light green is lowest confidence) which combined TWAS, MR, finemapping and coloc results:	 
- C1: the gene is MR or cTWAS significant, and the variant is in a CS95% overlapping between the GWAS and the xQTL (from single context finemapping)
- C2: the gene is MR or cTWAS significant, and the variant is colocalizing (using colocboost) between the GWAS and the xQTL
- C3: the gene is TWAS significant, and the variant is colocalizing or in  CS95% overlapping between the GWAS and the xQTL
- C4: the variant is in a CS95% overlapping between the GWAS and the xQTL (from single context finemapping)
- C5: the variant is colocalizing or overlapping with any xQTL CS (multicontext, cs50, cs70) or with sn-sQTL
- C6:  the gene is TWAS significant only

**Notes:**  
TWAS significant: having TWAS pvalue <2.5e-6 for the best method OR for more than 50% of the methods.  
MR significant: being TWAS significant + having cpip>0.5 & num_CS >=2& I2<0.5.  
cTWAS significant: the xQTL explain the GWAS zscore with pip > 0.75  

The '+' or '-' after the context name correspond to the direction of the effect on the gene/molecular trait observed in finemapping (first '+/-') or in colocboost (second '+/-'). 
'Effect' column correspond to the effect on the molecular traits, 
  

For more details please check out [this page](https://statfungen.github.io/xqtl-resources/xqtl_resource_description/#alzheimers-disease-gwas-integration)

## Others contents
- `res_allanalysis_ADloci_overlap.csv.gz` : a long/flatten version of the excel table, where each row is a variant-ADlocus-Method-context-gene_name information, facilitating querying informations. It contains also all variants associated to the loci (instead of top variants per loci) 

- `AD_loci_unified_cs95orColocs_Pval1e5_variant_level.csv.gz` : a table for the unified AD loci where each row is a variant of these loci

- `context_meta.tsv` generated by Ru Feng

### generation of `context_meta.tsv`
```bash
cat /mnt/vast/hpc/homes/rf2872/codes/xqtl-analysis/analysis/Wang_Columbia/susie_twas/*/commands_to_submit.txt |grep -oP '(?<=--phenotype-names )[^\\]*'| sed 's/\s--.*$//' | awk -v OFS=',' '{for (i=1; i<=NF; i++) printf "%s%s", $i, (i==NF?ORS:OFS)}'   > context.txt
cat /mnt/vast/hpc/homes/rf2872/codes/xqtl-analysis/analysis/Wang_Columbia/susie_twas/*/commands_to_submit.txt |grep -oP '(?<=--name )[^\\]*'| sed 's/\s--.*$//' |sed 's/ //g' > analysis_name.txt
 

paste context.txt analysis_name.txt | awk '{printf "%-30s %s\n", $1, $2}' > combined.txt


cat /mnt/vast/hpc/homes/rf2872/codes/xqtl-analysis/analysis/Wang_Columbia/fsusie/*/commands_to_submit.txt |grep -oP '(?<=--phenotype-names )[^\\]*'| sed 's/\s--.*$//' | awk -v OFS=',' '{for (i=1; i<=NF; i++) printf "%s%s", $i, (i==NF?ORS:OFS)}'   > context.txt
cat /mnt/vast/hpc/homes/rf2872/codes/xqtl-analysis/analysis/Wang_Columbia/fsusie/*/commands_to_submit.txt |grep -oP '(?<=--name )[^\\]*'| sed 's/\s--.*$//' |sed 's/ //g' > analysis_name.txt
 

paste context.txt analysis_name.txt | awk '{printf "%-30s %s\n", $1, $2}' >> combined.txt



cat /mnt/vast/hpc/homes/rf2872/codes/xqtl-analysis/analysis/Wang_Columbia/susie_twas_trans/*/commands_to_submit.txt |grep -oP '(?<=--phenotype-names )[^\\]*'| sed 's/\s--.*$//' | awk -v OFS=',' '{for (i=1; i<=NF; i++) printf "%s%s", $i, (i==NF?ORS:OFS)}'   > context.txt
cat /mnt/vast/hpc/homes/rf2872/codes/xqtl-analysis/analysis/Wang_Columbia/susie_twas_trans/*/commands_to_submit.txt |grep -oP '(?<=--name )[^\\]*'| sed 's/\s--.*$//' |sed 's/ //g' > analysis_name.txt
 

paste context.txt analysis_name.txt | awk '{printf "%-30s %s\n", $1, $2}' >> combined.txt
```


```R
df <- fread('/mnt/vast/hpc/homes/rf2872/codes/CUMC_fungun_xqtl_analysis/analysis/Others/combined.txt', sep = ' ', header = FALSE)
colnames(df) <- c('context', 'analysis_name')

df <- df %>% mutate(cohort = str_split(analysis_name, "_", simplify = T) %>% .[,1])  %>% filter(!str_detect(analysis_name, 'leafcutter2'))
df <- df[,c('cohort','context','analysis_name')]
write_delim(df, '/mnt/vast/hpc/homes/rf2872/codes/xqtl-analysis/resource/context_meta.tsv', delim = '\t')
```


